workdir = "deployment_artifacts"
project_home = "https://github.com/data-capsule/psl-cvm"

[deployment_config]
provider = "aws"
mode = "modest"
ssh_key = "cluster_key.pem"
ssh_user = "psladmin" # DO NOT CHANGE THIS for AWS.
node_port_base = 3000


[node_config]

[node_config.net_config]
client_max_retry = 10

[node_config.rpc_config]
recv_buffer_size = 32768
channel_depth = 1000

[node_config.consensus_config]
commit_index_gap_soft = 250
commit_index_gap_hard = 500
liveness_u = 2
max_backlog_batch_size = 1000
signature_max_delay_blocks = 50
signature_max_delay_ms = 102 # roughly batch_max_delay_ms * signature_max_delay_blocks
num_crypto_workers = 5
view_timeout_ms = 4000
batch_max_delay_ms = 50
max_audit_snapshots = 5
max_audit_buffer_size = 10
max_audit_delay_ms = 1000

[node_config.worker_config]
all_writes_max_batch_size = 1000
self_writes_max_batch_size = 16
self_reads_max_batch_size = 16
batch_max_delay_ms = 2
signature_max_delay_ms = 20000
signature_max_delay_blocks = 50
num_crypto_workers = 5
num_worker_threads_per_worker = 4
num_replier_threads_per_worker = 4
read_cache_size = 1

[node_config.worker_config.state_storage_config.RocksDB]
write_buffer_size = 67_108_864 # 64MB
max_write_buffer_number = 4
max_write_buffers_to_merge = 1

[node_config.consensus_config.log_storage_config.RocksDB]
write_buffer_size = 2147483648
max_write_buffer_number = 1
max_write_buffers_to_merge = 1

[node_config.app_config]
logger_stats_report_ms = 100
checkpoint_interval_ms = 60000

[node_config.evil_config]
simulate_byzantine_behavior = false
byzantine_start_block = 0


[client_config]
full_duplex = true
client_sub_id = 0       # This is filled up later by the caller code.

[client_config.net_config]
client_max_retry = 10

[client_config.workload_config]
request_config = "Blanks"
max_concurrent_requests = 16

# [[experiments]]
# name = "flink"
# repeats = 1
# num_storage_nodes = 3
# num_sequencer_nodes = 1
# node_distribution = "tag:worker"
# storage_distribution = "uniform"
# sequencer_distribution = "uniform"
# num_clients = 1
# type = "flink"
# build_command = "make"
# duration = 60

# [experiments.client_config]
# psl_enabled = true

# [experiments.sweeping_parameters]
# # num_clients = [10, 20, 50, 100, 200, 250, 300, 350, 400]
# # num_clients = [100, 200, 400, 500, 700, 800]
# num_nodes = [1, 2, 4, 8, 16]

[[experiments]]
name = "flink_no_psl"
repeats = 1
num_storage_nodes = 3
num_sequencer_nodes = 1
node_distribution = "tag:worker"
storage_distribution = "uniform"
sequencer_distribution = "uniform"
num_clients = 1
type = "flink"
build_command = "make"
duration = 60

[experiments.client_config]
psl_enabled = false

[experiments.sweeping_parameters]
# num_clients = [10, 20, 50, 100, 200, 250, 300, 350, 400]
# num_clients = [100, 200, 400, 500, 700, 800]
num_nodes = [1, 2, 4, 8, 16]

[[results]]
name = "flink_results_parse"
plotter = "flink_results_parse"
output = "flink_experiment.pdf"
force_parse = true
# skip_indices = [0, 1, 2, 3]

[results.legends]
# Experiment group to legend mapping
pirateship = "pirateship+byz"
pirateship_sig_1 = "pirateship(sig=1)+byz"
pbft = "pbft+onlybyz"
signed_raft = "signed_raft"

[results.font]
size = 55
